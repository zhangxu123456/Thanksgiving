<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>点点橙-感恩节活动</title>
    <meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.0.2/css/swiper.min.css"/>-->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/jquery.fullpage.min.css">
    <link rel="stylesheet" href="css/css.css">

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/fullPage.js/2.9.4/jquery.fullpage.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.0.2/js/swiper.min.js"></script>-->
    <!--<script src="./js/Preload.js"></script>-->
</head>
<body>

<div class="swiper-container" id="fullpage">
    <ul class="swiper-wrapper">
        <li class="section page1">

            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page2">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="make_speech">
                <p>谢谢你的包容</p>
                <p>第一次当妈妈</p>
                <p>   难免笨手笨脚</p>
                <p>   真不好意思</p>
                <p>  你成长中大脑门儿上的</p>
                <p>  磕磕碰碰</p>
                <p>  有一半是妈妈干的</p>
            </div>
            <div class="rili">
                <img src="./images/rili_img@3x.png" alt="">
            </div>
            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page3">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="make_speech">
                <p>谢谢你给我勇气</p>
                <p>其实我也很怕黑</p>
                <p>但想到要保护你</p>
                <p>我只好赶紧勇敢起来</p>
                <p>……</p>
                <p>这感觉真不赖！</p>
            </div>
            <div class="rili">
                <img src="./images/chest_img@3x.png" alt="">
            </div>
            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page4">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="make_speech">
                <p>谢谢你送我另一双眼睛</p>
                <p>陪你趴在草地上</p>
                <p>看蜗牛和小蚂蚁的我</p>
                <p>好像重新变回了小孩</p>
            </div>
            <div class="rili">
                <img src="./images/heart_img@3x.png" alt="">
            </div>
            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page7">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="make_speech">
                <p>做妈妈是件太辛苦的事</p>
                <p>但</p>
                <p>也只有做妈妈的人才知道</p>
                <p>宝贝给我们的</p>
                <p>比我们付出的</p>
                <p>要多得多</p>
            </div>
            <div class="rili">
                <img src="./images/gift_img@3x.png" alt="">
            </div>
            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page8">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="make_speech">
                <p>是时候了</p>
                <p>在这个感恩的日子</p>
                <p>对孩子郑重道出我们的感谢</p>
            </div>
            <div class="rili">
                <img src="./images/redheart_img@3x.png" alt="">
            </div>
            <div class="say_babe">
                我想对宝宝说
            </div>
            <div class="arrow">
                <img src="./images/arrows.png" alt="">
            </div>
        </li>
        <li class="section page5">
            <h1 class="logo"><img src="./images/logo@3x.png" alt=""></h1>
            <div class="head_portrait" id="headimg">
                <img class="tihuan" src="./images/headbig.png" alt="">
            </div>
            <div class="uploading btn">
                上传宝宝图片
            </div>

            <div class="write_text">
                <img src="./images/write_text@3x.png" alt="">
            </div>
            <div class="text">谢谢宝贝，有了你</div>
            <p class="kuang"><textarea class="textarea_input" id="input-text-box-one" placeholder="60个字以内..."></textarea></p>

            <!--<div class="text">更加</div>
            <p class="kuang"><textarea class="textarea_input" id="input-text-box-two" placeholder="30个字以内..."></textarea></p>-->

            <div class="uploading haibao">
                生成心里话海报
            </div>
        </li>
        <!--<li class="section page6">
            <div class="babe-thinks">
                <img src="./images/babe_thanks.jpg" alt="">
            </div>
            <div class="submit_in">
                <p class="sub_left sub">重新填写</p>
                <p class="sub_right sub">告诉大家</p>
            </div>
        </li>-->

    </ul>
</div>

<div class="clipbg displaynone">
    <div id="clipArea"></div>
    <div class="loading displaynone">正在载入图片...</div>
    <div class="footer">
        <dl>
            <dd style="background: #fe1041; color: #ffffff;border: none;">打开相册<input type="file" id="file" accept="image/*" ></dd>
            <dd id="clipBtn">完成裁剪</dd>
        </dl>
        <div class="back">取消</div>
    </div>
</div>

<!--代码部分begin-->
<div id="lanren">
    <div id="audio-btn" class="on" onclick="lanren.changeClass(this,'media')">
        <audio loop="loop" src="./images/AudioJoiner171122232738.mp3" id="media" preload="preload"></audio>
    </div>
</div>

<div class="box_smak one">
    <div><textarea class="box_input_one" placeholder="60个字以内..."></textarea></div>
    <p class="box_smak_text_one">还可以输入60个字</p>
</div>

<!--<div class="box_smak two">
    <textarea class="box_input_two" placeholder="30个字以内..."></textarea>
    <p class="box_smak_text_two">还可以输入30个字</p>
</div>-->

<div class="box_smak three">
    <ul>
        <li class="create_txt">生成图片质量较高，请耐心等待～</li>
        <li class="create_img"><img src="./images/loading.gif" alt=""></li>
    </ul>
</div>

</body>
</html>
<script>
    var lanren = {
        changeClass: function (target,id) {
            var className = $(target).attr('class');
            var ids = document.getElementById(id);
            (className == 'on')
                ? $(target).removeClass('on').addClass('off')
                : $(target).removeClass('off').addClass('on');
            (className == 'on')
                ? ids.pause()
                : ids.play();
        },
        play:function(){
            document.getElementById('media').play();
        }
    }
    lanren.play();


    document.addEventListener('DOMContentLoaded', function () {
        function audioAutoPlay() {
            var audio = document.getElementById('media');
            audio.play();
            document.addEventListener("WeixinJSBridgeReady", function () {
                audio.play();
            }, false);
        }
        audioAutoPlay();
    });
    <!--代码部分end-->

</script>
<script type="text/javascript" src="js/hammer.min.js" ></script>
<script type="text/javascript" src="js/lrz.all.bundle.js" ></script>
<script type="text/javascript" src="js/iscroll-zoom-min.js" ></script>
<script type="text/javascript" src="js/PhotoClip.js" ></script>


<script>
    $(document).ready(function() {
        function GetQueryString(name)
        {
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
        }
        var pageurl=GetQueryString('pageurl');
            console.log(pageurl)
            if(!pageurl){
                $('#fullpage').fullpage();
                console.log('fullpage')
            }else{
                $('#fullpage').fullpage();
                $.fn.fullpage.silentMoveTo(7)
                console.log('fullpage123')
            }


    });

       /* var swiper1 = new Swiper('#swiper1',{
            noSwiping : true,
            direction : 'vertical',
            noSwipingClass : 'stop-swiping',
            noSwiping : true
        });*/

</script>

<script>
    (function () {
        var dataURL_add=null;

        $(".btn").click(function(){
            $(".clipbg").fadeIn();

        })
        var clipArea = new  PhotoClip("#clipArea", {
            size: [300, 300],//裁剪框大小
            outputSize:[0,0],//打开图片大小，[0,0]表示原图大小
            file: "#file",
            ok: "#clipBtn",
            loadStart: function() { //图片开始加载的回调函数。this 指向当前 PhotoClip 的实例对象，并将正在加载的 file 对象作为参数传入。（如果是使用非 file 的方式加载图片，则该参数为图片的 url）
                $(".loading").removeClass("displaynone");

            },
            loadComplete: function() {//图片加载完成的回调函数。this 指向当前 PhotoClip 的实例对象，并将图片的 <img> 对象作为参数传入。
                $(".loading").addClass("displaynone");

            },
            done: function(dataURL) { //裁剪完成的回调函数。this 指向当前 PhotoClip 的实例对象，会将裁剪出的图像数据DataURL作为参数传入。
                dataURL_add=dataURL
                console.log(dataURL);//dataURL裁剪后图片地址base64格式提交给后台处理
                $('.tihuan').attr('src',dataURL)
                $(".clipbg").fadeOut()
            }
        });
        $(".back").click(function(){
            $(".clipbg").fadeOut();

        })
        $('.say_babe').click(function () {
            $.fn.fullpage.moveSectionDown()
        });
        /*点击生成图片*/
        $('.uploading.haibao').click(function () {
            var inputtextboxone = $('#input-text-box-one').val();
            /*var inputtextboxtwo = $('#input-text-box-two').val();*/
            console.log(dataURL_add)
            console.log(inputtextboxone)
            /*console.log(inputtextboxtwo)*/
            if(!dataURL_add){
                alert('请上传图片')
                return false;
            }
            if(!inputtextboxone){
                alert('请填写内容');
                return false;
            }
//                var url="http://47.96.172.56/api/v1/images/handle"
            $.ajax({
                type: "POST",
                url: "http://47.96.172.56/api/v1/images/handle",
                data: {fileString:dataURL_add, words:inputtextboxone},
                beforeSend:function () {
                    $('.box_smak.three').css('display','block');
                },
                success:function (data) {
                    var data=data
                    console.log(data)
                    if(data.code==0 && data.message=='成功'){
                        console.log('跳转');
                        localStorage['dataURL']=data.result.path;
                        location.href="./share.html"
                    }
                },
                complete:function () {
                    $('.box_smak.three').css('display','none');
                }
            })
        })


    }())
</script>

<script>

    /*判断机型*/
    var u = navigator.userAgent;
    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端

    /*判断机型  end*/
    if(isAndroid){
        (function () {
            var num_one=60,total_one=null;
            $('#input-text-box-one').focus(function () {

                $('.box_smak.one').css('display','block');
                $('.box_input_one').focus();
                $('.box_input_one').on('input',function () {

                    var len = $(this).val().length;
                    total_one=num_one-len;
                    $('.box_smak_text_one').html('还可以输入<span>'+total_one+'</span>个字')
                    if(total_one < 0){
                        $('.box_smak_text_one span').css('color','red')
                    }
                })
            });

            $('.box_input_one').blur(function () {
                if(total_one >= 0){
                    var val_cont=$('.box_input_one').val();

                    $('#input-text-box-one').val(val_cont);
                    $('.box_smak.one').css('display','none')
                }
            });
        }());

        /*第二个*/
        /*(function () {
            var num_two=30,total_two=null;
            $('#input-text-box-two').focus(function () {

                $('.box_smak.two').css('display','block');
                $('.box_input_two').focus();
                $('.box_input_two').on('input',function () {

                    var len = $(this).val().length;
                    total_two=num_two-len;
                    $('.box_smak_text_two').html('还可以输入<span>'+total_two+'</span>个字')
                    if(total_two < 0){
                        $('.box_smak_text_two span').css('color','red')
                    }
                })
            });

            $('.box_input_two').blur(function () {
                if(total_two >= 0) {
                    var val_cont = $('.box_input_two').val();
                    $('#input-text-box-two').val(val_cont);
                    $('.box_smak.two').css('display', 'none')
                }
            });
        }())*/

    }

//    onfocus="textfocus(this)" onblur="textblur(this)" rows=""
    /*function textfocus(o){
        o.style.position = 'fixed';
        o.style.top = '50px';
        o.style.zIndex = '999';
    }
    function textblur(o){
        o.style.position = 'static';
        o.style.top = 'auto';
    }*/

    /*$(document).ready(function () {
        var elements = [
            './images/1.png',
            './images/chest_img.png',
            './images/heart_img.png',
            './images/logo.jpg',
            './images/rili_img.png',
            './images/write_text.png',
        ];
        var preload = new Preload();
        preload.init( 'wrapper', elements, function() {

        });
    })*/


</script>